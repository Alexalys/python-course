# Модуль 2. Управляющие конструкции. Исключения
По-умолчанию в Python выражения выполняются одно за одним сверху вниз. 
Последовательность выполнения выражений в программе называется «поток выполнения» (Flow of execution). 

Программы, в которых все команды выполняются одна за одной называются *линейными программами*.
В программировании существует всего три способа управления потоком выполнения: 

* ветвления (оператор выбора);
* циклы;
* исключения.

Обе данные структуры (и цикл и оператор выбора) используют *логические выражения.* 

## Логические выражения
Логические выражения &mdash; это такие выражения, результатом выполнения которых будет значения типа `boolean`
(`True` - правда или `False` &mdash; ложь).

Например: `3 > 3` (`False`), `7 >= 2` (`True`), ` 2 + 2 == 4` (`True`)

В большинстве случаев логические выражения &mdash; это результат сравнения или оператора членства, или тождественности.

Для удобства в Python добавили механизм неявного приведения любого типа к типу `bool`. 
Правила приведения к `bool` &mdash; интуитивны:
* число `0` приводится к `False` (целое, дробное или комплексное);
* `None` приводится к `False`;
* пустой контейнер (пустой список, пустой словарь, пустая строка и т.п.) приводятся к `False`
* всё остальное приводится к `True`

Правила приведения к `bool` позволяют писать условные выражения в Python практически на литературном английском. 
В любом случае, такой код становится очень понятным.

## Булева алгебра
Булева алгебра &mdash; это применение математических символов и выражений для логических отношений. Булева алгебра строится
на трёх основных операциях: "И", "ИЛИ", "НЕ". Есть ещё вспомогательные, но давайте пока рассмотрим основные.

### and (И)

**Выражение правдиво, если оба условия правдивы**

<table class="tg">
<thead>
  <tr>
    <th class="tg-c3ow">A</th>
    <th class="tg-c3ow">B</th>
    <th class="tg-c3ow">A and B</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">True</td>
  </tr>
  <tr>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">False</td>
  </tr>
  <tr>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">False</td>
  </tr>
  <tr>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">False</td>
  </tr>
</tbody>
</table>

### or (ИЛИ)

**Выражение правдиво, если хоть одно из условий правдиво**

<table class="tg">
<thead>
  <tr>
    <th class="tg-c3ow">A</th>
    <th class="tg-c3ow">B</th>
    <th class="tg-c3ow">A or B</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">True</td>
  </tr>
  <tr>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">True</td>
  </tr>
  <tr>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">True</td>
  </tr>
  <tr>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">False</td>
  </tr>
</tbody>
</table>

#### not (НЕ)

**Отрицание, выражение правдиво, если операнд - ложь**

<table class="tg">
<thead>
  <tr>
    <th class="tg-c3ow">A</th>
    <th class="tg-c3ow">not A</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-c3ow">True</td>
    <td class="tg-c3ow">False</td>
  </tr>
  <tr>
    <td class="tg-c3ow">False</td>
    <td class="tg-c3ow">True</td>
  </tr>
</tbody>
</table>


### Создание переменных типа `bool`

Есть 3 способа создать переменную с типом `bool`: 
* Присвоить переменной значение `True` или `False`
* Присвоить переменной результат выполнения логической операции
* Использовать функцию `bool` для приведения к типу `bool`
  
```python
a = True
b = False

c = a and b
d = a or b 
e = not a

f = bool(1)

print(c)    # False
print(d)    # True
print(e)    # False
print(f)    # True
```

## Условное выполнение
В Python реализован оператор контроля выполнения (условный оператор) `if ... elif ... else`.

С помощью этого инструмента существует возможность контролировать поток выполнения (по-умолчанию выполняются все команды
сверху вниз).
Оператор контроля исполнения позволяет выполнять определенные участки кода не всегда, а только тогда, когда будет 
выполнено определенные условия.

Синтаксис оператора выбора состоит из обязательного ключевого слова `if` и необязательных `elif`, `else`.

Условный оператор начинается с ключевого слова `if` за которым следует условие (переменная типа `bool`, или выражение,
который возвращает `bool`).

После условия ставится двоеточие и с новой строки с отступом идет один или более операторов, которые будут выполнены в 
случае, когда условие будет равняться `True`.

После блока `if` может быть ноль или более блоков `elif`, интерпретатор последовательно будет проверять
все условия `elif` сверху вниз, пока не найдет то, которое возвращает `True`, или они закончатся.

После блока(ов) `elif` может содержаться один блок `else`, который выполнится, если все предыдущие условия равны 
`False`.

## Условия
В качестве операторов условий часто используют сравнения.
Сравнение происходит с помощью операторов `<` (меньше), `<=` (меньше или равно),
  `>` (Больше), `>=` (больше или равно), `==` (равно), `!=` (Не равно).

```python
a = 3
b = 5
c = a < b # True
d = a > b # False
```

Определим является ли число, которое ввел пользователь, положительным (больше нуля).
```python
a = input('Введите число')
if int(a) > 0:
    print("Число положительное")
```
Но бывают случаи, когда нам одного сравнения недостаточно для того, чтобы решить задачу. 
В случае анализа числа нам необходимо дать ответ когда число положительное (больше нуля), отрицательное (меньше нуля) и 
когда непосредственно является нулем.
```python
a = int(input('Введите число'))
if a > 0:
    print('Число положительное')
elif a < 0:
    print("Число отрицательное")
else:
    print('Это число - ноль')
```
Во время выполнения условного оператора интерпретатор Python проверяет условия сверху вниз пока не найдет то,
которое выполняется, затем выполнит выражение для этого условия и выйдет из проверки условий.

```python
a = int(input('Введите число'))
if a > 0:
    print('Число положительное')
elif a == 1:
    print('Число равно 1')
else:
    print("a <= 0")
```
В таком случае код для условия `a == 1` никогда не исполнится.

Разберем реализацию условного оператора на примере определения агрегатного состояния воды (лед, вода, пар), 
то есть если вода имеет температуру ниже 0 градусов по Цельсию &mdash; она превращается в лед, если вода имеет температуру
от 0 до 100 градусов она находится в жидком состоянии, то есть непосредственно водой и, если температура воды выше 100 
градусов, то она превратится в пар.

```python
t = input("Введите температуру воды")
t = int(t) # Переводим строку t в число
if t <= 0:
    print("Это - лед")
elif 0 < t < 100:
    print("Это - вода")
else:
    print("Это - пар")
```

## Последовательность условий
Условие в операторе выбора может быть составным.
```python
t = input("Введите температуру воды")
t = int(t) # Переводим строку t в число
if t <= 0:
    print("Это - лед")
elif 0 < t < 100:
    print("Это - вода")
else:
    print("Это - пар")
```

## Вложенные условия
В Python внутрь одного оператора может быть вложен другой.
Пример такой вложенности для определения четвертей для координатной плоскости.
```python
if x > 0:
    if y > 0:               # x>0, y>0
        print("Первая четверть")
    else:                   # x>0, y<0
        print("Четвертая четверть")
else:
    if y > 0:               # x<0, y>0
        print("Вторая четверть")
    else:                   # x<0, y<0
        print("Третья четверть")
```

## Перехват исключений с использованием try и except

Исключение в Python &mdash; это ошибка на уровне механизма запуска программы (интерпретатора), вызванная невозможностью 
выполнить тот или иной оператор, по каким-либо причинам (переменная не существует, синтаксическая ошибка, 
отсутствует атрибут, операция деления на ноль и т.д.).

Например, наш скрипт ожидает данных от пользователя в формате целого числа. Но, пользователь может ввести любой символ 
(например строка 'a'), в таком случае, при попытке конвертировать введен символ в число, произойдет ошибка:

```python
val = 'a' # специально запишем символ, который нельзя сконверировать в десятичное число
print("Вы ввели: ", int(val)) # Тут случится ошибка
```
В данном случае программа прекратит свою работу и пользователь так и не узнает, что привело к этому сбою. 
Однако мы можем обработать эту ошибку (такая ошибка называется `ValueError`).

`ValueError` &mdash; это ошибка (исключение), которая происходит в случае невозможности конвертировать текущее значение 
в нужный тип данных.

В нашем примере (ввели `'а'`) интерпретатор пытается преобразовать строку в тип `int` (целое число), но как переводится 
строка `'a'` в число &mdash; не определено и будет вызвано исключение по этому поводу.

## Механизм обработки исключений

Для обработки исключений существует оператор `try ... except ...`. Синтаксически, этот оператор начинается с ключевого 
слова `try:` (попробовать) и продолжается блоком кода на следующей строке, который выделен отступом.

Далее идет блок обработки исключений `except` (кроме), где можно указать одно, или более исключений, 
после которых выполнить следующий блок кода. Этот блок не обязателен, но чаще всего нужен. Он выполнится если случится
указанное исключение (одно из них, если их несколько).

Потом идёт необязательный блок кода, который начинается с ключевого слова `finally`, он выполнится в любом случае.

Последним идёт необязательный блок, который начинается с ключевого слова `else`. Этот код выполнится только если 
исключений не случилось.

В нашем примере обработка пользовательского ввода будет выглядеть следующим образом:

```python
val = 'a'
try:
    print("Вы ввели: ", int(val))
except ValueError:
    print("Некорректный символ")
```
Исключения в Python &mdash; это очень мощный инструмент, который часто используется для управления потоком выполнения, а не
только для обработки ошибок. В динамических языках никогда нельзя быть на 100% уверенным в том, что пользователь
ввёл значение корректного типа или что другое приложение не вернуло `None` вместо `int`, например.
 
Наивным решением этой проблемы будет повсеместное использование проверок `if` на корректность введенного пользователем
или другим приложением значения. Более продвинутым, удобным и прозрачным решением является использование механизма
обработки исключений там, где они могут случиться из-за некорректных входных данных.  

## Циклы 

Для того, чтобы повторить какой-то блок кода несколько раз или повторять пока выполняется некоторое условие в Python,
реализованны циклы. Есть два вида циклов:
* цикл `for`, который ещё называют итерирующим, он перебирает все элементы
    некоторой последовательности; 
* цикл `while`, который выполняется пока выполняется некоторое условие.

Итерация (лат. iteratio «повторение») &mdash; повторение какого-либо действия. 
Итерация в программировании &mdash; организация обработки данных, при которой действия повторяются многократно, 
не приводя при этом к вызовам самих себя.

Одна итерация &mdash; это одно повторение.

### Цикл for
В Python, цикл `for` используется для перебора всех элементов контейнеров, или итерируемых объектов, например, списков.
Операторы, которые находятся в теле цикла будут выполнены столько раз, сколько элементов в списке.

При этом, на каждом шагу специальная переменная получает значение одного из элементов списка.

Работу цикла `for` можно сравнить с тем, что вы по очереди возьмете каждый фрукт из корзины и проговорите его название 
(корзиной в данном случае будет выступать список строк с названиями фруктов, а аналогом произнесения вслух будет выступать вывод 
соответствующих строк в консоль).

```python
fruits = ['apple', 'pear', 'apricot', 'orange', 'plum']
for fruit in fruits:
    print(fruit)
```

Цикл `for` на практике используется для формирования новых списков на основе уже существующих.
Например, из существующего списка (с числами от 1 до 10) перенесем в новый список только те числа, которые кратны 3.

Определение кратности обеспечивается с помощью оператора `%` ("остаток от деления»).
То есть, если остаток от деления числа на 3 равен нулю, то такое число кратно 3.

Также важной особенностью является то, что 0 соответствует логическому значению `False` есть выражения
`a % 3 == 0` и `not a% 3` будут эквивалентными.

Пример работы такого оператора:

```python
a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
result = []
for elem in a:
    if not elem % 3:
       result.append(elem)

print(result)   # Виведе [3, 6, 9]
```

Синтаксис цикла `for`: 
1. цикл начинается с ключевого слова `for`;
2. за которым обязательно идёт название переменной куда будет записываться значение получаемое из итерируемого объекта на каждой итерации;
3. далее следует ключевое слово `in`;
4. за которым обязательно идёт выражение или объект по которому собственно будет итерироваться `for`; 
5. далее ставится `:`;
6. и с новой строки с отступом идёт набор выражений, которые будут повторятся на каждой итерации.   

### Цикл while

Цикл `while` позволяет выполнять операторы, которые находятся в теле цикла до тех пор, пока выполняется условие, 
указанное в цикле. Например, цикл `while`, который выводит числа от 1 до 5:

```python
a = 1
while a <= 5:
    print(a)
    a = a + 1
```

Условием может быть любое выражение, которое автоматически будет приведено к типу `bool`.

### «Бесконечные циклы» и break
Бывают ситуации, когда необходимо выйти из цикла до завершения итерации, не дожидаясь пока произойдет очередная проверка
условия. Для этого есть команда `break`.
Команда `break` &mdash; полностью останавливает цикл в момент вызова и не завершает итерацию.
```python
a = 0
while True:
    print(a)
    if a == 20:
        break
    a +=1
```

### Завершение итерации с помощью continue
Также для того, чтобы сразу перейти к следующей итерации цикла без выполнения оставшихся выражений есть команда 
`continue`. Вызов этой команды в теле цикла приводит к тому, что оставшиеся выражения этой итерации не будут выполнены,
а интерпретатор сразу перейдет к следующей итерации или проверке условия.

```python
a = 0
while a < 20:
    a +=1
    if a % 2 == 0:
        continue
    print(a)
```

Операторы `continue` и `break` работают только внутри одного цикла. В ситуации вложенных циклов нет способа выйти из 
всех циклов сразу. Также использование `continue` или `break` вне цикла приводит к синтаксической ошибке.


## Домашнее задание

Напишите программу, которая будет выполнять простейшие математические операции с числами последовательно принимая
от пользователя операнды (числа) и оператор.

### Условия приёмки
* Приложение работает с целыми и дробными числами.
* Приложение умеет выполнять такие математические операции:
    * СЛОЖЕНИЕ (+)
    * ВЫЧИТАНИЕ (-)
    * УМНОЖЕНИЕ (*)
    * ДЕЛЕНИЕ (/)
* Приложение принимает один операнд или один оператор за один цикл запрос-ответ.
* Все операции приложение выполняет по мере поступления одну за одной. 
* Приложение выводит результат вычислений когда получает от пользователя `=`.
* Приложение заканчивает свою работу после того, как выведет результат вычисления.
* Пользователь по очереди вводит числа и операторы.
* Если пользователь вводит оператор два раза подряд, то он получает сообщение об ошибке и может ввести повторно.
* Если пользователь вводит число два раза подряд, то он получает сообщение об ошибке и может ввести повторно.
* Приложение корректно обрабатывает ситуацию некорректного ввода. 